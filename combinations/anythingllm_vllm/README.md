

# AnythingLLM + vLLM

–ó–∞–ø—É—Å–∫ LLM —Å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º —á–µ—Ä–µ–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:
- [**AnythingLLM**](https://github.com/Mintplex-Labs/anything-llm) - –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å LLM
- [**vLLM**](https://github.com/vllm-project/vllm) - –∑–∞–ø—É—Å–∫ LLM –º–æ–¥–µ–ª–µ–π


## üê≥üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
```
git clone https://github.com/sergey21000/webui-llm-examlples
cd webui-llm-examlples/anythingllm_vllm
```

–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª `.env` —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```sh
cp env.example .env
```
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–µ `.env` –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ (—Å—Å—ã–ª–∫–∏ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤–Ω—É—Ç—Ä–∏ —Ñ–∞–π–ª–∞ `.env`)

–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥–∏ —Å CLI –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ –∑–∞–ø—É—Å–∫–∞ vLLM (–≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ñ–∏–≥–æ–≤ —Å—Å—ã–ª–∫–∏ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é)
```
üìÅ ../data/
‚îú‚îÄ‚îÄ üìÅ vllm/                      # –¥–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å–∞ vLLM
|   ‚îî‚îÄ‚îÄ üìÅ configs/               # –∫–æ–Ω—Ñ–∏–≥–∏ CLI –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∑–∞–ø—É—Å–∫–∞ vLLM
|       |‚îÄ‚îÄ vllm_config_cpu.yml   # –∫–æ–Ω—Ñ–∏–≥ CPU (–¥–ª—è –∑–∞–ø—É—Å–∫–∞ `docker compose up`)
|       ‚îî‚îÄ‚îÄ vllm_config_cuda.yml  # –∫–æ–Ω—Ñ–∏–≥ CUDA (–¥–ª—è –∑–∞–ø—É—Å–∫–∞ `docker compose -f compose.cuda.yml up`)
‚îî‚îÄ‚îÄ üìÅ anythingllm/               # –¥–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å–∞ AnythingLLM
    ‚îî‚îÄ‚îÄ .env                      # –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ AnythingLLM, –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
```

–ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
- –ó–∞–ø—É—Å–∫ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π CPU (–¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π avx512)
  ```sh
  docker compose up -d
  ```
- –ó–∞–ø—É—Å–∫ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π CUDA
  ```sh
  docker compose -f compose.cuda.yml up -d
  ```
- –ó–∞–ø—É—Å–∫ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π CPU (–¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π avx2)
  –í–∞—Ä–∏–∞–Ω—Ç —Å –∑–∞–ø—É—Å–∫–æ–º vLLM –∏–∑ –≥–æ—Ç–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞
  ```sh
  docker compose -f compose.cpu.avx2.yml up -d
  ```
  –í–∞—Ä–∏–∞–Ω—Ç —Å–æ —Å–±–æ—Ä–∫–æ–π —Å–≤–æ–µ–≥–æ –æ–±—Ä–∞–∑–∞
  ```sh
  git clone https://github.com/vllm-project/vllm
  docker compose -f compose.build.cpu.avx2.yml up
  ```
  –£–∑–Ω–∞—Ç—å –∫–∞–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ [CPU-Z](https://www.cpuid.com/softwares/cpu-z.html)

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
```sh
docker compose ps
```
–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
```
docker compose logs -f
```

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–µ—Ä–≤–∏—Å—ã –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ –∞–¥—Ä–µ—Å–∞–º:
- AnythingLLM Web UI: http://127.0.0.1:3001
- vLLM API: http://127.0.0.1:8000/v1
- vLLM Models http://127.0.0.1:8000/v1/models

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ AnythingLLM —Å–æ–∑–¥–∞—Ç—å —Ä–∞–±–æ—á–µ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ, —Å–ª–µ–¥—É—è –ø–æ–¥—Å–∫–∞–∑–∫–∞–º –Ω–∞ —ç–∫—Ä–∞–Ω–µ  

–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ LLM –º–æ–∂–Ω–æ –≤ 2—Ö –º–µ—Å—Ç–∞—Ö:
- `–ù–∞—Å—Ç—Ä–æ–π–∫–∏` -> `–ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–µ LLM` -> –≤—ã–±—Ä–∞—Ç—å `–ü–æ—Å—Ç–∞–≤—â–∏–∫ LLM` Generic OpenAI, `Base URL` http://vllm:8000/v1, —É–∫–∞–∑–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `Token context window` –∏ `Max Tokens` (–Ω–µ –±–æ–ª—å—à–µ —á–µ–º –≤ –∫–æ–Ω—Ñ–∏–≥–µ –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `üìÅ ../data/vllm/configs/`) -> `Save Changes`
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ (—à–µ—Å—Ç—Ä–µ–Ω–∫–∞ –æ–∫–æ–ª–æ –Ω–∞–∑–≤–∞–Ω–∏—è —Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –≤ –ª–µ–≤–æ–π –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏ —ç–∫—Ä–∞–Ω–∞) - `–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —á–∞—Ç–∞` -> `–ü–æ—Å—Ç–∞–≤—â–∏–∫ LLM` Generic OpenAI -> `Update Workspace`  
–í –æ–±–æ–∏—Ö —Å–ª—É—á–∞—è—Ö –Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –≤ `Chat Model Name` –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –º–æ–¥–µ–ª–∏ vLLM (–º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ `üìÅ ../data/vllm/configs/` –∏–ª–∏ –Ω–∞ http://127.0.0.1:8000/v1/models)  

–û—Ç–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π - –¥–æ–±–∞–≤–∏—Ç—å `/no_think ` –≤ –Ω–∞—á–∞–ª–æ –∑–∞–ø—Ä–æ—Å–∞

---
–í–∞—Ä–∏–∞–Ω—Ç –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ –±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è `-f compose.cuda.yml`

–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `COMPOSE_FILE`
- Linux
  ```sh
  export COMPOSE_FILE=compose.cuda.yml
  ```
- Windows PowerShell
  ```ps1
  $env:COMPOSE_FILE="compose.cuda.yml"
  ```

–ó–∞–ø—É—Å–∫
```sh
docker compose up -d
```
