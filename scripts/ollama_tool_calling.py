import requests
from loguru import logger

from ollama import chat
from ollama import ChatResponse


# –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ –æ —Å—Ç—Ä–∞–Ω–µ —á–µ—Ä–µ–∑ https://restcountries.com/
# —É –º–µ–Ω—è –ª–æ–∫–∞–ª—å–Ω–æ –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω –¥–∞–Ω–Ω—ã–π —Å–∞–π—Ç, –Ω–æ –≤–æ–æ–±—â–µ –æ–Ω —Ä–∞–±–æ—á–∏–π
# def get_country_info(country: str) -> dict:
    # """
    # Get basic information about a country:
    # capital, population, currency code
    # """
    # url = f'https://restcountries.com/v3.1/name/{country}'
    # resp = requests.get(url, timeout=10)
    # resp.raise_for_status()
    # data = resp.json()[0]
    # currency_code = list(data['currencies'].keys())[0]
    # return {
        # 'name': data['name']['common'],
        # 'capital': data['capital'][0],
        # 'population': data['population'],
        # 'currency': currency_code,
    # }


# –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ –æ —Å—Ç—Ä–∞–Ω–µ —á–µ—Ä–µ–∑ https://github.com/trevorblades/countries
def get_country_info(country_code: str) -> dict:
    """
    Get basic information about a country using ISO 3166-1 alpha-2 code.

    Args:
        country_code: Country code (e.g. "DE", "JP", "BR")

    Returns:
        Dict with country name, native name, emoji, currency, languages
    """
    url = 'https://countries.trevorblades.com'

    query = {
        'query': f"""
        {{
          country(code: "{country_code.upper()}") {{
            name
            native
            emoji
            currency
            languages {{
              code
              name
            }}
          }}
        }}
        """
    }
    resp = requests.post(url, json=query, timeout=10)
    resp.raise_for_status()
    data = resp.json()['data']['country']
    if data:
        return {
            'name': data['name'],
            'native': data['native'],
            'emoji': data['emoji'],
            'currency': data['currency'],  # e.g. "EUR"
            'languages': [lang['name'] for lang in data['languages']],
        }


# –ø–æ–ª—É—á–µ–Ω–∏—è –∫—É—Ä—Å–∞ –≤–∞–ª—é—Ç—ã —á–µ—Ä–µ–∑ https://github.com/jsdelivr/api (—É—Å—Ç–∞—Ä–µ–≤—à–∏–π, –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏)
def get_currency_rate(base: str, target: str) -> float:
    """
    Get exchange rate from base currency to target currency.
    Uses free @fawazahmed0 currency API (no API key required).

    Args:
        base: Base currency code (e.g. "EUR")
        target: Target currency code (e.g. "USD")

    Returns:
        Exchange rate as float
    """
    base = base.lower()
    target = target.lower()
    url = (
        'https://cdn.jsdelivr.net/npm/'
        '@fawazahmed0/currency-api@latest/v1/currencies/'
        f'{base}.json'
    )
    resp = requests.get(url, timeout=10)
    resp.raise_for_status()
    data = resp.json()
    return data[base][target]


# —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –±–µ–∑ –Ω–µ–≥–æ)
system_prompt = (
    '–¢—ã –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –û–ë–Ø–ó–ê–ù –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è '
    '–ª—é–±–æ–π —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.\n'
    '–ù–µ —É–≥–∞–¥—ã–≤–∞–π –∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π –∑–Ω–∞–Ω–∏—è –∏–∑ –ø–∞–º—è—Ç–∏.\n'
    '–í—Å–µ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, –µ—Å–ª–∏ –æ–Ω–∏ –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞.\n'
    '–§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç:\n'
    '- –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ\n'
    '- –∫—Ä–∞—Ç–∫–∏–π\n'
    '- –±–µ–∑ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π –∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏–π\n'
)
# system_prompt = ''
# –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–º—Ç
prompt = (
    '–†–∞—Å—Å–∫–∞–∂–∏ –∫—Ä–∞—Ç–∫–æ –ø—Ä–æ –ì–µ—Ä–º–∞–Ω–∏—é –∏ –Ø–ø–æ–Ω–∏—é '
    '–∏ —É–∫–∞–∂–∏ –∫—É—Ä—Å –∏—Ö –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≤–∞–ª—é—Ç—ã –∫ —Ä—É–±–ª—é.'
)
# —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –ø–æ–¥–∞—á–∏ –≤ –º–æ–¥–µ–ª—å / –∏—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–ø–∏—Å–∫–∏
messages = []
if system_prompt:
    messages.append({'role': 'system', 'content': system_prompt})
messages.append({'role': 'user', 'content': prompt})

# –º–æ–¥–µ–ª—å –∏–∑ Ollama list
model = 'qwen3:4b'

# –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ –º–æ–¥–µ–ª–∏ —Å tool calling
# –º–æ–¥–µ–ª—å –¥–æ–ª–∂–Ω–∞ –ø–æ—Ä–∞—Å—Å—É–∂–¥–∞—Ç—å —á—Ç–æ —è –¥–æ–ª–∂–Ω–∞ –≤—ã–∑–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ –≤–µ—Ä–Ω—É—Ç—å —Å–∞–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
# —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å –ø–æ–º–æ—â—å—é structured outputs
response: ChatResponse = chat(
    model=model,
    messages=messages,
    # —Ñ—É–Ω–∫—Ü–∏–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π
    tools=[get_country_info, get_currency_rate],
    # –≤–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–π (–Ω–µ –≤—Å–µ–≥–¥–∞ –æ—Ç–∫–ª—é—á–∞–µ—Ç)
    think=True,
)
messages.append(response.message)
logger.info(f'\n–û—Ç–≤–µ—Ç –º–æ–¥–µ–ª–∏ –¥–æ –≤—ã–∑–æ–≤–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤: {messages}')

# –º–æ–¥–µ–ª—å –¥–æ–ª–∂–Ω–∞ —Å–æ–∑–¥–∞—Ç—å 4 [ToolCall, arguments], –ø–æ –¥–≤–∞ –Ω–∞ –∫–∞–∂–¥—É—é –≤–∞–ª—é—Ç—É, –Ω–∞–ø—Ä–∏–º–µ—Ä:
# ToolCall(function=Function(name='get_currency_rate', arguments={'base': 'EUR', 'target': 'RUB'}))
if response.message.tool_calls:
    logger.info(f'–§–ª–∞–≥ response.message.tool_calls: {response.message.tool_calls}')
    for call in response.message.tool_calls:
        if call.function.name == 'get_country_info':
            logger.info(f'\n–í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ get_country_info —Å –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ {call.function.arguments}')
            result = get_country_info(**call.function.arguments)
            logger.info(f'\n–†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–∑–æ–≤–∞ get_country_info: {result}')
        elif call.function.name == 'get_currency_rate':
            logger.info(f'\n–í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ get_currency_rate —Å –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ {call.function.arguments}')
            result = get_currency_rate(**call.function.arguments)
            logger.info(f'\n–†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–∑–æ–≤–∞ get_currency_rate: {result}')
        else:
            result = 'Unknown tool'
        # –¥–æ–±–∞–≤–∏—Ç—å –≤ –∏—Å—Ç–æ—Ä–∏—é –ø–µ—Ä–µ–ø–∏—Å–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–∑–æ–≤–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
        messages.append(
            {
                'role': 'tool',
                'tool_name': call.function.name,
                'content': str(result),
            }
        )
    logger.info(f'\n–°–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–µ—Ä–µ–¥ —Ñ–∏–Ω–∞–ª—å–Ω—ã–º –∑–∞–ø—Ä–æ—Å–æ–º: {messages}')
    final_response: ChatResponse = chat(
        model=model,
        messages=messages,
        tools=[get_country_info, get_currency_rate],
        think=True,
    )
    # logger.info(final_response.message.content)
    logger.info(f'\n–§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç final_response.message: {final_response.message}')


# –≤—ã–≤–æ–¥ –æ—Ç–≤–µ—Ç–∞ —Å —Å–æ–∫—Ä–∞—â–µ–Ω–Ω—ã–º–∏ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏—è–º–∏

# 2026-01-13 09:10:21.467 | INFO     | __main__:<module>:121 - –û—Ç–≤–µ—Ç –º–æ–¥–µ–ª–∏ –¥–æ –≤—ã–∑–æ–≤–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤: [{'role': 'system', 'content': '–¢—ã –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –û–ë–Ø–ó–ê–ù –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ª—é–±–æ–π —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.\n–ù–µ —É–≥–∞–¥—ã–≤–∞–π –∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π –∑–Ω–∞–Ω–∏—è –∏–∑ –ø–∞–º—è—Ç–∏.\n–í—Å–µ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, –µ—Å–ª–∏ –æ–Ω–∏ –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞.\n–§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç:\n- –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ\n- –∫—Ä–∞—Ç–∫–∏–π\n- –±–µ–∑ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π –∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏–π\n'}, {'role': 'user', 'content': '–†–∞—Å—Å–∫–∞–∂–∏ –∫—Ä–∞—Ç–∫–æ –ø—Ä–æ –ì–µ—Ä–º–∞–Ω–∏—é –∏ –Ø–ø–æ–Ω–∏—é –∏ —É–∫–∞–∂–∏ –∫—É—Ä—Å –∏—Ö –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≤–∞–ª—é—Ç—ã –∫ —Ä—É–±–ª—é.'}, Message(role='assistant', content='', thinking='–•–æ—Ä–æ—à–æ, –º–Ω–µ –Ω—É–∂–Ω–æ –æ—Ç–≤–µ—Ç–∏—Ç—å –∫—Ä–∞—Ç–∫–æ –ø—Ä–æ –ì–µ—Ä–º–∞–Ω–∏—é –∏ –Ø–ø–æ–Ω–∏—é –∏ —É–∫–∞–∑–∞—Ç—å –∫—É—Ä—Å –∏—Ö –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –≤–∞–ª—é—Ç –∫ —Ä—É–±–ª—é. –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—é, –∫–∞–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —É –º–µ–Ω—è –µ—Å—Ç—å. –í –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö –µ—Å—Ç—å get_country_info –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ –∫–æ–¥—É –±—ã—Ç—å –Ω–∞ —Ä—É—Å—Å–∫–æ–º, –∫—Ä–∞—Ç–∫–∏–π, –±–µ–∑ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π. –ù–æ —ç—Ç–æ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤. –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ, —Å–Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, –ø–æ—ç—Ç–æ–º—É –æ—Ç–≤–µ—Ç –±—É–¥–µ—Ç —Å–æ—Å—Ç–æ—è—Ç—å –∏–∑ tool_call.\n\n–ù–æ –≤ –∑–∞–¥–∞–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –≤–æ–∑–º–æ–∂–Ω–æ, –æ–∂–∏–¥–∞–µ—Ç—Å—è, —á—Ç–æ –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –±—É–¥–µ—Ç –æ—Ç–≤–µ—Ç, –Ω–æ –ø–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, —è –¥–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã.\n\n–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –≤ –æ—Ç–≤–µ—Ç–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å XML —Å tool_calls.\n\n–ù–æ –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç –∫—Ä–∞—Ç–∫–æ –æ—Ç–≤–µ—Ç–∏—Ç—å, –Ω–æ —Å–Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã.\n\n–í –∏—Ç–æ–≥–µ, —è –¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞—Ç—å 4 tool_calls.\n', images=None, tool_name=None, tool_calls=[ToolCall(function=Function(name='get_country_info', arguments={'country_code': 'DE'})), ToolCall(function=Function(name='get_country_info', arguments={'country_code': 'JP'})), ToolCall(function=Function(name='get_currency_rate', arguments={'base': 'EUR', 'target': 'RUB'})), ToolCall(function=Function(name='get_currency_rate', arguments={'base': 'JPY', 'target': 'RUB'}))])]

# 2026-01-13 09:10:21.467 | INFO     | __main__:<module>:124 - –§–ª–∞–≥ response.message.tool_calls: [ToolCall(function=Function(name='get_country_info', arguments={'country_code': 'DE'})), ToolCall(function=Function(name='get_country_info', arguments={'country_code': 'JP'})), ToolCall(function=Function(name='get_currency_rate', arguments={'base': 'EUR', 'target': 'RUB'})), ToolCall(function=Function(name='get_currency_rate', arguments={'base': 'JPY', 'target': 'RUB'}))]

# 2026-01-13 09:10:21.467 | INFO     | __main__:<module>:127 - –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ get_country_info —Å –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ {'country_code': 'DE'}

# 2026-01-13 09:10:22.651 | INFO     | __main__:<module>:129 - –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–∑–æ–≤–∞ get_country_info: {'name': 'Germany', 'native': 'Deutschland', 'emoji': 'üá©üá™', 'currency': 'EUR', 'languages': ['German']}

# 2026-01-13 09:10:22.652 | INFO     | __main__:<module>:127 - –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ get_country_info —Å –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ {'country_code': 'JP'}

# 2026-01-13 09:10:23.656 | INFO     | __main__:<module>:129 - –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–∑–æ–≤–∞ get_country_info: {'name': 'Japan', 'native': 'Êó•Êú¨', 'emoji': 'üáØüáµ', 'currency': 'JPY', 'languages': ['Japanese']}

# 2026-01-13 09:10:23.656 | INFO     | __main__:<module>:131 - –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ get_currency_rate —Å –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ {'base': 'EUR', 'target': 'RUB'}

# 2026-01-13 09:10:24.277 | INFO     | __main__:<module>:133 - –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–∑–æ–≤–∞ get_currency_rate: 91.31701482

# 2026-01-13 09:10:24.277 | INFO     | __main__:<module>:131 - –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ get_currency_rate —Å –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ {'base': 'JPY', 'target': 'RUB'}

# 2026-01-13 09:10:24.896 | INFO     | __main__:<module>:133 - –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–∑–æ–≤–∞ get_currency_rate: 0.50308886

# 2026-01-13 09:10:24.896 | INFO     | __main__:<module>:143 - –°–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–µ—Ä–µ–¥ —Ñ–∏–Ω–∞–ª—å–Ω—ã–º –∑–∞–ø—Ä–æ—Å–æ–º: [{'role': 'system', 'content': '–¢—ã –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –û–ë–Ø–ó–ê–ù –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ª—é–±–æ–π —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.\n–ù–µ —É–≥–∞–¥—ã–≤–∞–π –∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π –∑–Ω–∞–Ω–∏—è –∏–∑ –ø–∞–º—è—Ç–∏.\n–í—Å–µ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, –µ—Å–ª–∏ –æ–Ω–∏ –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞.\n–§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç:\n- –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ\n- –∫—Ä–∞—Ç–∫–∏–π\n- –±–µ–∑ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π –∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏–π\n'}, {'role': 'user', 'content': '–†–∞—Å—Å–∫–∞–∂–∏ –∫—Ä–∞—Ç–∫–æ –ø—Ä–æ –ì–µ—Ä–º–∞–Ω–∏—é –∏ –Ø–ø–æ–Ω–∏—é –∏ —É–∫–∞–∂–∏ –∫—É—Ä—Å –∏—Ö –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≤–∞–ª—é—Ç—ã –∫ —Ä—É–±–ª—é.'}, Message(role='assistant', content='', thinking='–•–æ—Ä–æ—à–æ, –º–Ω–µ –Ω—É–∂–Ω–æ –æ—Ç–≤–µ—Ç–∏—Ç—å –∫—Ä–∞—Ç–∫–æ –ø—Ä–æ –ì–µ—Ä–º–∞–Ω–∏—é –∏ –Ø–ø–æ–Ω–∏—é –∏ —É–∫–∞–∑–∞—Ç—å –∫—É—Ä—Å –∏—Ö –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –≤–∞–ª—é—Ç –∫ —Ä—É–±–ª—é. –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –≤–æ–∑–º–æ–∂–Ω–æ, –æ–∂–∏–¥–∞–µ—Ç—Å—è, —á—Ç–æ –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –±—É–¥–µ—Ç –æ—Ç–≤–µ—Ç, –Ω–æ –ø–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, —è –¥–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã.\n\n–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –≤ –æ—Ç–≤–µ—Ç–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å XML —Å tool_calls.\n\n–ù–æ –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç –∫—Ä–∞—Ç–∫–æ –æ—Ç–≤–µ—Ç–∏—Ç—å, –Ω–æ —Å–Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã.\n\n–í –∏—Ç–æ–≥–µ, —è –¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞—Ç—å 4 tool_calls.\n', images=None, tool_name=None, tool_calls=[ToolCall(function=Function(name='get_country_info', arguments={'country_code': 'DE'})), ToolCall(function=Function(name='get_country_info', arguments={'country_code': 'JP'})), ToolCall(function=Function(name='get_currency_rate', arguments={'base': 'EUR', 'target': 'RUB'})), ToolCall(function=Function(name='get_currency_rate', arguments={'base': 'JPY', 'target': 'RUB'}))]), {'role': 'tool', 'tool_name': 'get_country_info', 'content': "{'name': 'Germany', 'native': 'Deutschland', 'emoji': 'üá©üá™', 'currency': 'EUR', 'languages': ['German']}"}, {'role': 'tool', 'tool_name': 'get_country_info', 'content': "{'name': 'Japan', 'native': 'Êó•Êú¨', 'emoji': 'üáØüáµ', 'currency': 'JPY', 'languages': ['Japanese']}"}, {'role': 'tool', 'tool_name': 'get_currency_rate', 'content': '91.31701482'}, {'role': 'tool', 'tool_name': 'get_currency_rate', 'content': '0.50308886'}]

# 2026-01-13 09:10:36.640 | INFO     | __main__:<module>:151 - –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç final_response.message: role='assistant' content='–ì–µ—Ä–º–∞–Ω–∏—è: –µ–≤—Ä–æ (91,32 —Ä—É–±/–µ).  \n–Ø–ø–æ–Ω–∏—è: –∏–µ–Ω—ã (0,50 —Ä—É–±/–∏).' thinking='–•–æ—Ä–æ—à–æ, –º–Ω–µ –Ω—É–∂–Ω–æ –æ—Ç–≤–µ—Ç–∏—Ç—å –∫—Ä–∞—Ç–∫–æ –Ω–∞ –≤–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø—Ä–æ –ì–µ—Ä–º–∞–Ω–∏—é –∏ –Ø–ø–æ–Ω–∏—é –∏ –∫—É—Ä—Å –∏—Ö –≤–∞–ª—é—Ç –∫ —Ä—É–±–ª—é.\n\n–°–Ω–∞—á–∞–ª–∞ –ø–æ—Å–º–æ—Ç—Ä—é –Ω–∞ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –£ –Ω–∞—Å –µ—Å—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤. \n\n–ü–µ—Ä–≤—ã–π tool_call –¥–ª—è DE (–ì–µ—Ä–º–∞–Ω–∏—è) –≤–µ—Ä–Ω—É–ª: —Å—Ç—Ä–∞–Ω–∞ –ì–µ—Ä–º–∞–Ω–∏—è, –≤–∞–ª—é—Ç–∞ EUR. –í—Ç–æ—Ä–æ–π tool_call –¥–ª—è JP (–Ø–ø–æ–Ω–∏—è) ‚Äî –Ø–ø–æ–Ω–∏—è, –≤–∞–ª—é—Ç–∞ JPY. \n\n–ü–æ—Ç–æ–º –ø–æ–ª—É—á–µ–Ω—ã –∫—É—Ä—Å—ã: EUR –∫ RUB ‚Äî 91.317, JPY –∫ RUB ‚Äî 0.503. \n\n–ù—É–∂–Ω–æ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ —ç—Ç–æ –≤ –∫—Ä–∞—Ç–∫–∏–π –æ—Ç–≤–µ—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º. \n\n–°–Ω–∞—á–∞–ª–∞ –∫—Ä–∞—Ç–∫–æ –ø—Ä–æ —Å—Ç—Ä–∞–Ω—ã: –ì–µ—Ä–º–∞–Ω–∏—è ‚Äî —Å—Ç–æ–ª–∏—Ü–∞ –ë–µ—Ä–ª–∏–Ω, –Ω–∞—Å–µ–ª–µ–Ω–∏–µ –æ–∫–æ–ª–æ 83 –º–ª–Ω, –≤–∞–ª—é—Ç–∞ –µ–≤—Ä–æ. –Ø–ø–æ–Ω–∏—è ‚Äî –¢–æ–∫–∏–æ, –Ω–∞—Å–µ–ª–µ–Ω–∏–µ ~125 –º–ª–Ω, –≤–∞–ª—é—Ç–∞ –∏–µ–Ω—ã. –ù–æ –ø–æ –¥–∞–Ω–Ω—ã–º –∏–∑ tool, —É –Ω–∞—Å —Ç–æ–ª—å–∫–æ –∏–º—è, —è–∑—ã–∫–∏, –≤–∞–ª—é—Ç–∞ –∏ —Ç.–¥. –í–æ–∑–º–æ–∂–Ω–æ, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —É–ø–æ–º—è–Ω—É—Ç—å —Å—Ç—Ä–∞–Ω—É, –≤–∞–ª—é—Ç—É –∏ –∫—É—Ä—Å.\n\n–ö—É—Ä—Å: 1 –µ–≤—Ä–æ = 91,32 —Ä—É–±–ª—è, 1 –∏–µ–Ω–∞ = 0,50 —Ä—É–±–ª—è. \n\n–ù—É–∂–Ω–æ –∫—Ä–∞—Ç–∫–æ –æ—Ñ–æ—Ä–º–∏—Ç—å. –ù–∞–ø—Ä–∏–º–µ—Ä:\n\n–ì–µ—Ä–º–∞–Ω–∏—è: –≤–∞–ª—é—Ç–∞ –µ–≤—Ä–æ (EUR). 1 –µ–≤—Ä–æ ‚âà 91,32 —Ä—É–±–ª—è.  \n–Ø–ø–æ–Ω–∏—è: –≤–∞–ª—é—Ç–∞ –∏–µ–Ω—ã (JPY). 1 –∏–µ–Ω–∞ ‚âà 0,50 —Ä—É–±–ª—è.\n\n–ù–æ –≤ –æ—Ç–≤–µ—Ç–µ –Ω—É–∂–Ω–æ —É–±—Ä–∞—Ç—å –ª–∏—à–Ω–µ–µ, —Å–¥–µ–ª–∞—Ç—å –∫—Ä–∞—Ç–∫–æ. –ü—Ä–æ–≤–µ—Ä—é, –Ω–µ—Ç –ª–∏ –æ—à–∏–±–æ–∫ –≤ –∫—É—Ä—Å–∞—Ö. –í tool_call –¥–ª—è EUR –∫ RUB –ø–æ–ª—É—á–∏–ª–æ—Å—å 91.317, –¥–ª—è JPY ‚Äî 0.503. –¢–æ –µ—Å—Ç—å, –ø—Ä–∏–º–µ—Ä–Ω–æ 91.32 –∏ 0.50.\n\n–¢–∞–∫–∂–µ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏–ª –∫—Ä–∞—Ç–∫–æ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø—Ä–æ —Å—Ç—Ä–∞–Ω—ã. –í–æ–∑–º–æ–∂–Ω–æ, –¥–æ–±–∞–≤–∏—Ç—å —Å—Ç–æ–ª–∏—Ü—É –∏ –Ω–∞—Å–µ–ª–µ–Ω–∏–µ –∏–∑ –¥–∞–Ω–Ω—ã—Ö. –ù–æ –≤ tool_info –¥–ª—è DE –∏ JP –≤ –æ—Ç–≤–µ—Ç–µ –Ω–µ—Ç –Ω–∞—Å–µ–ª–µ–Ω–∏—è –∏ —Å—Ç–æ–ª–∏—Ü. –í –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Ç–æ–ª—å–∫–æ –∏–º—è, —è–∑—ã–∫–∏, —ç–º–æ–¥–∑–∏ –∏ –≤–∞–ª—é—Ç–∞. –ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –ì–µ—Ä–º–∞–Ω–∏–∏: name: Germany, native: Deutschland, emoji: üá©üá™, currency: EUR, languages: [\'German\']. –¢–æ –µ—Å—Ç—å, –º–æ–∂–Ω–æ —É–ø–æ–º—è–Ω—É—Ç—å, —á—Ç–æ –ì–µ—Ä–º–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≤—Ä–æ, —Å—Ç–æ–ª–∏—Ü–∞ –ë–µ—Ä–ª–∏–Ω (–Ω–æ –≤ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç —Å—Ç–æ–ª–∏—Ü—ã, –ø–æ—ç—Ç–æ–º—É –Ω–µ –¥–æ–±–∞–≤–ª—è—é). \n\n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏–ª –∫—Ä–∞—Ç–∫–æ, –ø–æ—ç—Ç–æ–º—É –ª—É—á—à–µ —É–ø–æ–º—è–Ω—É—Ç—å —Ç–æ–ª—å–∫–æ –≤–∞–ª—é—Ç—É –∏ –∫—É—Ä—Å. \n\n–ò—Ç–∞–∫, —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º:\n\n–ì–µ—Ä–º–∞–Ω–∏—è: –µ–≤—Ä–æ (1 EUR ‚âà 91,32 —Ä—É–±).  \n–Ø–ø–æ–Ω–∏—è: –∏–µ–Ω—ã (1 JPY ‚âà 0,50 —Ä—É–±).\n\n–ù–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ —Å–ª–∏—à–∫–æ–º –ª–∏ –¥–ª–∏–Ω–Ω–æ. –í–æ–∑–º–æ–∂–Ω–æ, —É–±—Ä–∞—Ç—å "‚âà" –∏ –æ–∫—Ä—É–≥–ª–∏—Ç—å –¥–æ –¥–≤—É—Ö –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π.\n\n–¢–∞–∫–∂–µ, –≤ –∫—É—Ä—Å–∞—Ö, –≤–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å, —á—Ç–æ —ç—Ç–æ –∫—É—Ä—Å –∫ —Ä—É–±–ª—é. \n\n–í –æ—Ç–≤–µ—Ç–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫—Ä–∞—Ç–∫–æ, –±–µ–∑ –ª–∏—à–Ω–∏—Ö –¥–µ—Ç–∞–ª–µ–π. \n\n–í–µ—Ä–æ—è—Ç–Ω–æ, —Ç–∞–∫:\n\n–ì–µ—Ä–º–∞–Ω–∏—è: –µ–≤—Ä–æ (91,32 —Ä—É–±/–µ).  \n–Ø–ø–æ–Ω–∏—è: –∏–µ–Ω—ã (0,50 —Ä—É–±/–∏).\n\n–ù–æ –≤ –∑–∞–¥–∞–Ω–∏–∏ —Å–∫–∞–∑–∞–Ω–æ, —á—Ç–æ –æ—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫—Ä–∞—Ç–∫–∏–º, –Ω–∞ —Ä—É—Å—Å–∫–æ–º. \n\n–î–∞, –≤—Ä–æ–¥–µ –ø–æ–¥–æ–π–¥–µ—Ç.\n' images=None tool_name=None tool_calls=None
